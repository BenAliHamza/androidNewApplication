===== FILE: ./app/src/main/java/tn/esprit/data/remote/ApiClient.java =====
package tn.esprit.data.remote;

import okhttp3.OkHttpClient;
import okhttp3.logging.HttpLoggingInterceptor;
import retrofit2.Call;
import retrofit2.Retrofit;
import retrofit2.converter.gson.GsonConverterFactory;
import retrofit2.http.Body;
import retrofit2.http.POST;

/**
 * Provides a configured Retrofit instance to talk to the Spring Boot backend.
 * Uses 10.0.2.2 so the Android emulator can reach localhost:8080 on your machine.
 *
 * NOTE: This client is intentionally small and focused on auth for now.
 * Later we can split it into separate files (AuthApi, UserApi, DoctorApi...)
 * to avoid it becoming a god-class.
 */
public class ApiClient {

    private static final String BASE_URL = "http://10.0.2.2:8080/";
    private static Retrofit retrofit;

    private ApiClient() {
        // No instances
    }
    public static <T> T createService(Class<T> serviceClass) {
        return getRetrofit().create(serviceClass);
    }

    private static Retrofit getRetrofit() {
        if (retrofit == null) {
            HttpLoggingInterceptor logging = new HttpLoggingInterceptor();
            // Always log BODY for now (you can change to NONE for production)
            logging.setLevel(HttpLoggingInterceptor.Level.BODY);

            OkHttpClient client = new OkHttpClient.Builder()
                    .addInterceptor(logging)
                    .build();

            retrofit = new Retrofit.Builder()
                    .baseUrl(BASE_URL)
                    .client(client)
                    .addConverterFactory(GsonConverterFactory.create())
                    .build();
        }
        return retrofit;
    }

    public static AuthApiService getAuthApiService() {
        return getRetrofit().create(AuthApiService.class);
    }

    /**
     * Retrofit API for /auth endpoints.
     */
    public interface AuthApiService {

        @POST("auth/login")
        Call<TokenResponseDto> login(@Body LoginRequestDto request);

        @POST("auth/signup")
        Call<TokenResponseDto> signup(@Body SignupRequestDto request);

        @POST("auth/refresh")
        Call<TokenResponseDto> refresh(@Body RefreshTokenRequestDto request);
    }

    /**
     * Matches backend dto.auth.LoginRequest (email, password).
     */
    public static class LoginRequestDto {
        private String email;
        private String password;

        public LoginRequestDto(String email, String password) {
            this.email = email;
            this.password = password;
        }

        public String getEmail() {
            return email;
        }

        public void setEmail(String email) {
            this.email = email;
        }

        public String getPassword() {
            return password;
        }

        public void setPassword(String password) {
            this.password = password;
        }
    }

    /**
     * Matches backend dto.auth.SignupRequest
     * (firstname, lastname, email, phone, password, role).
     */
    public static class SignupRequestDto {
        private String firstname;
        private String lastname;
        private String email;
        private String phone;
        private String password;
        private String role; // "DOCTOR" or "PATIENT"

        public SignupRequestDto(String firstname,
                                String lastname,
                                String email,
                                String phone,
                                String password,
                                String role) {
            this.firstname = firstname;
            this.lastname = lastname;
            this.email = email;
            this.phone = phone;
            this.password = password;
            this.role = role;
        }

        public String getFirstname() {
            return firstname;
        }

        public void setFirstname(String firstname) {
            this.firstname = firstname;
        }

        public String getLastname() {
            return lastname;
        }

        public void setLastname(String lastname) {
            this.lastname = lastname;
        }

        public String getEmail() {
            return email;
        }

        public void setEmail(String email) {
            this.email = email;
        }

        public String getPhone() {
            return phone;
        }

        public void setPhone(String phone) {
            this.phone = phone;
        }

        public String getPassword() {
            return password;
        }

        public void setPassword(String password) {
            this.password = password;
        }

        public String getRole() {
            return role;
        }

        public void setRole(String role) {
            this.role = role;
        }
    }

    /**
     * Matches backend dto.auth.RefreshTokenRequest (refreshToken).
     */
    public static class RefreshTokenRequestDto {
        private String refreshToken;

        public RefreshTokenRequestDto(String refreshToken) {
            this.refreshToken = refreshToken;
        }

        public String getRefreshToken() {
            return refreshToken;
        }

        public void setRefreshToken(String refreshToken) {
            this.refreshToken = refreshToken;
        }
    }

    /**
     * Matches backend dto.auth.TokenResponse
     * (accessToken, refreshToken, tokenType, expiresIn).
     */
    public static class TokenResponseDto {
        private String accessToken;
        private String refreshToken;
        private String tokenType;
        private Long expiresIn;

        public String getAccessToken() {
            return accessToken;
        }

        public void setAccessToken(String accessToken) {
            this.accessToken = accessToken;
        }

        public String getRefreshToken() {
            return refreshToken;
        }

        public void setRefreshToken(String refreshToken) {
            this.refreshToken = refreshToken;
        }

        public String getTokenType() {
            return tokenType;
        }

        public void setTokenType(String tokenType) {
            this.tokenType = tokenType;
        }

        public Long getExpiresIn() {
            return expiresIn;
        }

        public void setExpiresIn(Long expiresIn) {
            this.expiresIn = expiresIn;
        }
    }
}


===== FILE: ./app/src/main/java/tn/esprit/data/remote/indicator/IndicatorApiService.java =====
package tn.esprit.data.remote.indicator;

import java.math.BigDecimal;

import retrofit2.Call;
import retrofit2.http.Body;
import retrofit2.http.DELETE;
import retrofit2.http.GET;
import retrofit2.http.Header;
import retrofit2.http.POST;
import retrofit2.http.Path;
import retrofit2.http.Query;
import tn.esprit.data.remote.common.ListResponseDto;
import tn.esprit.domain.indicator.IndicatorType;
import tn.esprit.domain.indicator.PatientIndicator;

/**
 * Retrofit API for indicator-related endpoints.
 *
 * Matches backend:
 *  - GET /indicator-types
 *  - GET /indicators/me
 *  - POST /indicators/me
 *  - DELETE /indicators/me/{id}
 *  - GET /indicators/patient/{patientUserId}
 */
public interface IndicatorApiService {

    /**
     * GET /indicator-types
     *
     * Returns the static catalog of available indicator types.
     * (If you later require auth for this, we can add Authorization header.)
     */
    @GET("indicator-types")
    Call<ListResponseDto<IndicatorType>> getIndicatorTypes();

    /**
     * GET /indicators/me
     *
     * Lists indicators of the current patient.
     *
     * Query params (all optional):
     *  - indicatorTypeId
     *  - from (ISO-8601 date-time string)
     *  - to   (ISO-8601 date-time string)
     */
    @GET("indicators/me")
    Call<ListResponseDto<PatientIndicator>> getMyIndicators(
            @Header("Authorization") String authorization,
            @Query("indicatorTypeId") Long indicatorTypeId,
            @Query("from") String fromIso,
            @Query("to") String toIso
    );

    /**
     * POST /indicators/me
     *
     * Current patient adds a new indicator measurement.
     */
    @POST("indicators/me")
    Call<PatientIndicator> addMyIndicator(
            @Header("Authorization") String authorization,
            @Body PatientIndicatorCreateRequestDto request
    );

    /**
     * DELETE /indicators/me/{id}
     *
     * Current patient deletes one of their indicators by id.
     */
    @DELETE("indicators/me/{id}")
    Call<Void> deleteMyIndicator(
            @Header("Authorization") String authorization,
            @Path("id") Long indicatorId
    );

    /**
     * GET /indicators/patient/{patientUserId}
     *
     * Doctor lists indicators of a given patient (by patient User.id).
     * Requires current user to be DOCTOR and linked to that patient.
     */
    @GET("indicators/patient/{patientUserId}")
    Call<ListResponseDto<PatientIndicator>> getIndicatorsForPatientAsDoctor(
            @Header("Authorization") String authorization,
            @Path("patientUserId") Long patientUserId,
            @Query("indicatorTypeId") Long indicatorTypeId,
            @Query("from") String fromIso,
            @Query("to") String toIso
    );

    /**
     * Request body for POST /indicators/me.
     * Mirrors backend dto.indicator.PatientIndicatorCreateRequest.
     */
    class PatientIndicatorCreateRequestDto {

        private Long indicatorTypeId;   // required

        private BigDecimal numericValue; // optional; at least one of numeric/text
        private String textValue;

        /**
         * Optional ISO-8601 timestamp string.
         * If null, backend will use now().
         */
        private String measuredAt;

        private String note;

        public PatientIndicatorCreateRequestDto() {
        }

        public Long getIndicatorTypeId() {
            return indicatorTypeId;
        }

        public void setIndicatorTypeId(Long indicatorTypeId) {
            this.indicatorTypeId = indicatorTypeId;
        }

        public BigDecimal getNumericValue() {
            return numericValue;
        }

        public void setNumericValue(BigDecimal numericValue) {
            this.numericValue = numericValue;
        }

        public String getTextValue() {
            return textValue;
        }

        public void setTextValue(String textValue) {
            this.textValue = textValue;
        }

        public String getMeasuredAt() {
            return measuredAt;
        }

        public void setMeasuredAt(String measuredAt) {
            this.measuredAt = measuredAt;
        }

        public String getNote() {
            return note;
        }

        public void setNote(String note) {
            this.note = note;
        }
    }
}


===== FILE: ./app/src/main/java/tn/esprit/data/remote/doctor/SpecialtyApiService.java =====
package tn.esprit.data.remote.specialty;

import java.math.BigDecimal;
import java.util.List;

import retrofit2.Call;
import retrofit2.http.Body;
import retrofit2.http.GET;
import retrofit2.http.Header;
import retrofit2.http.Path;

public interface SpecialtyApiService {

    @GET("/api/specialties")
    Call<List<SpecialtyDto>> getAllSpecialties(
            @Header("Authorization") String authHeader
    );

    @GET("/api/specialties/{specialtyId}/acts")
    Call<List<ActDto>> getActsBySpecialty(
            @Header("Authorization") String authHeader,
            @Path("specialtyId") Long specialtyId
    );

    // --- DTOs mirroring your backend ---

    public static class SpecialtyDto {
        public Long id;
        public String code;
        public String name;
        public String description;
        public Boolean active;
    }

    public static class ActDto {
        public Long id;
        public String code;
        public String name;
        public String description;
        public BigDecimal basePrice;
        public Integer defaultDurationMinutes;
        public Boolean teleconsultationAvailable;
    }
}


===== FILE: ./app/src/main/java/tn/esprit/data/remote/doctor/DoctorApiService.java =====
package tn.esprit.data.remote.doctor;

import java.util.List;

import retrofit2.Call;
import retrofit2.http.Body;
import retrofit2.http.DELETE;
import retrofit2.http.GET;
import retrofit2.http.Header;
import retrofit2.http.POST;
import retrofit2.http.PUT;
import retrofit2.http.Path;
import retrofit2.http.Query;
import tn.esprit.data.remote.common.ListResponseDto;
import tn.esprit.domain.doctor.DoctorProfile;
import tn.esprit.domain.doctor.DoctorPublicProfile;
import tn.esprit.domain.doctor.DoctorSearchResult;
import tn.esprit.domain.patient.PatientProfile;

public interface DoctorApiService {

    /**
     * GET /api/doctors/me
     * Returns the current doctor's profile.
     */
    @GET("/api/doctors/me")
    Call<DoctorProfile> getMyProfile(
            @Header("Authorization") String authHeader
    );

    /**
     * PUT /api/doctors/me
     * Updates the current doctor's profile (bio, clinicAddress, etc.).
     */
    @PUT("/api/doctors/me")
    Call<DoctorProfile> updateMyProfile(
            @Header("Authorization") String authHeader,
            @Body DoctorProfileUpdateRequestDto request
    );

    /**
     * POST /api/doctors/me/practice-setup
     * Onboarding step: choose one specialty and the acts performed.
     * (Matches backend @PostMapping("/me/practice-setup")).
     */
    @POST("/api/doctors/me/practice-setup")
    Call<DoctorProfile> setupPracticeForCurrentDoctor(
            @Header("Authorization") String authHeader,
            @Body DoctorPracticeSetupRequestDto request
    );

    // ----------- Doctor's patients endpoints -----------

    /**
     * GET /api/doctors/me/patients
     * Returns patients linked to the current doctor, wrapped in ListResponse.
     */
    @GET("/api/doctors/me/patients")
    Call<ListResponseDto<PatientProfile>> getMyPatients(
            @Header("Authorization") String authHeader
    );

    /**
     * GET /api/doctors/me/patients/{patientUserId}
     * Returns details of a single patient (by User.id) linked to the current doctor.
     */
    @GET("/api/doctors/me/patients/{patientUserId}")
    Call<PatientProfile> getMyPatientByUserId(
            @Header("Authorization") String authHeader,
            @Path("patientUserId") Long patientUserId
    );

    /**
     * DELETE /api/doctors/me/patients/{patientUserId}
     * Removes link between current doctor and a patient.
     */
    @DELETE("/api/doctors/me/patients/{patientUserId}")
    Call<Void> removePatientFromMe(
            @Header("Authorization") String authHeader,
            @Path("patientUserId") Long patientUserId
    );

    // ----------- Public/search endpoints -----------

    /**
     * Public search endpoint for doctors.
     *
     * GET /api/doctors/search
     *
     * Backend now wraps results in ListResponse<DoctorSearchResultDto>.
     */
    @GET("/api/doctors/search")
    Call<ListResponseDto<DoctorSearchResult>> searchDoctors(
            @Header("Authorization") String authHeader,
            @Query("q") String query,
            @Query("specialtyId") Long specialtyId,
            @Query("city") String city,
            @Query("country") String country,
            @Query("teleconsultationEnabled") Boolean teleconsultationEnabled,
            @Query("acceptingNewPatients") Boolean acceptingNewPatients
    );

    /**
     * Public doctor profile endpoint.
     *
     * GET /api/doctors/{doctorId}/public
     */
    @GET("/api/doctors/{doctorId}/public")
    Call<DoctorPublicProfile> getDoctorPublicProfile(
            @Header("Authorization") String authHeader,
            @Path("doctorId") Long doctorId
    );

    // ----------- DTOs used as request bodies -----------

    /**
     * Mirrors backend DoctorProfileUpdateRequest.
     */
    class DoctorProfileUpdateRequestDto {

        private String bio;
        private Integer yearsOfExperience;
        private String clinicAddress;
        private String city;
        private String country;
        private String medicalRegistrationNumber;
        private java.math.BigDecimal consultationFee;
        private Boolean acceptsNewPatients;
        private Boolean teleconsultationEnabled;
        private Integer maxDailyAppointments;
        private Integer averageConsultationDurationMinutes;

        // --- getters & setters ---

        public String getBio() {
            return bio;
        }

        public void setBio(String bio) {
            this.bio = bio;
        }

        public Integer getYearsOfExperience() {
            return yearsOfExperience;
        }

        public void setYearsOfExperience(Integer yearsOfExperience) {
            this.yearsOfExperience = yearsOfExperience;
        }

        public String getClinicAddress() {
            return clinicAddress;
        }

        public void setClinicAddress(String clinicAddress) {
            this.clinicAddress = clinicAddress;
        }

        public String getCity() {
            return city;
        }

        public void setCity(String city) {
            this.city = city;
        }

        public String getCountry() {
            return country;
        }

        public void setCountry(String country) {
            this.country = country;
        }

        public String getMedicalRegistrationNumber() {
            return medicalRegistrationNumber;
        }

        public void setMedicalRegistrationNumber(String medicalRegistrationNumber) {
            this.medicalRegistrationNumber = medicalRegistrationNumber;
        }

        public java.math.BigDecimal getConsultationFee() {
            return consultationFee;
        }

        public void setConsultationFee(java.math.BigDecimal consultationFee) {
            this.consultationFee = consultationFee;
        }

        public Boolean getAcceptsNewPatients() {
            return acceptsNewPatients;
        }

        public void setAcceptsNewPatients(Boolean acceptsNewPatients) {
            this.acceptsNewPatients = acceptsNewPatients;
        }

        public Boolean getTeleconsultationEnabled() {
            return teleconsultationEnabled;
        }

        public void setTeleconsultationEnabled(Boolean teleconsultationEnabled) {
            this.teleconsultationEnabled = teleconsultationEnabled;
        }

        public Integer getMaxDailyAppointments() {
            return maxDailyAppointments;
        }

        public void setMaxDailyAppointments(Integer maxDailyAppointments) {
            this.maxDailyAppointments = maxDailyAppointments;
        }

        public Integer getAverageConsultationDurationMinutes() {
            return averageConsultationDurationMinutes;
        }

        public void setAverageConsultationDurationMinutes(Integer averageConsultationDurationMinutes) {
            this.averageConsultationDurationMinutes = averageConsultationDurationMinutes;
        }
    }

    /**
     * Mirrors backend DoctorPracticeSetupRequest.
     */
    class DoctorPracticeSetupRequestDto {
        public Long specialtyId;
        public java.util.List<Long> actIds;
    }
}


===== FILE: ./app/src/main/java/tn/esprit/data/remote/user/UserApiService.java =====
package tn.esprit.data.remote.user;

import retrofit2.Call;
import retrofit2.http.GET;
import retrofit2.http.Header;
import tn.esprit.domain.user.User;

/**
 * Retrofit API for general user operations.
 *
 * We directly return the domain User model to avoid extra mapping.
 */
public interface UserApiService {

    /**
     * GET /me
     * Authorization: Bearer <access_token>
     */
    @GET("me")
    Call<User> getCurrentUser(@Header("Authorization") String authorization);
}


===== FILE: ./app/src/main/java/tn/esprit/data/remote/user/UserImageApiService.java =====
package tn.esprit.data.remote.user;

import okhttp3.MultipartBody;
import retrofit2.Call;
import retrofit2.http.Header;
import retrofit2.http.Multipart;
import retrofit2.http.POST;
import retrofit2.http.Part;
import tn.esprit.domain.user.User;

/**
 * Retrofit service for user profile image operations.
 *
 * Matches backend:
 *   POST /users/me/profile-image
 *   multipart/form-data, field name = "image"
 *   returns UserDto â†’ mapped to tn.esprit.domain.user.User
 */
public interface UserImageApiService {

    @Multipart
    @POST("/users/me/profile-image")
    Call<User> uploadMyProfileImage(
            @Header("Authorization") String authHeader,
            @Part MultipartBody.Part image
    );
}


===== FILE: ./app/src/main/java/tn/esprit/data/remote/user/UserAccountApiService.java =====
package tn.esprit.data.remote.user;

import retrofit2.Call;
import retrofit2.http.Body;
import retrofit2.http.Header;
import retrofit2.http.PUT;

import tn.esprit.domain.user.User;

/**
 * API for base user information (firstname, lastname, email, phone).
 *
 * Uses:
 *   PUT /me
 */
public interface UserAccountApiService {

    class UserUpdateRequestDto {
        private String firstname;
        private String lastname;
        private String email;
        private String phone;

        public String getFirstname() {
            return firstname;
        }

        public void setFirstname(String firstname) {
            this.firstname = firstname;
        }

        public String getLastname() {
            return lastname;
        }

        public void setLastname(String lastname) {
            this.lastname = lastname;
        }

        public String getEmail() {
            return email;
        }

        public void setEmail(String email) {
            this.email = email;
        }

        public String getPhone() {
            return phone;
        }

        public void setPhone(String phone) {
            this.phone = phone;
        }
    }

    @PUT("/me")
    Call<User> updateCurrentUser(
            @Header("Authorization") String authHeader,
            @Body UserUpdateRequestDto body
    );
}


===== FILE: ./app/src/main/java/tn/esprit/data/remote/common/ListResponseDto.java =====
package tn.esprit.data.remote.common;

import java.util.List;

/**
 * Generic list wrapper matching backend dto.common.ListResponse<T>.
 *
 * JSON example:
 * {
 *   "items": [ ... ],
 *   "total": 3
 * }
 */
public class ListResponseDto<T> {

    private List<T> items;
    private long total;

    public ListResponseDto() {
    }

    public List<T> getItems() {
        return items;
    }

    public void setItems(List<T> items) {
        this.items = items;
    }

    public long getTotal() {
        return total;
    }

    public void setTotal(long total) {
        this.total = total;
    }
}


===== FILE: ./app/src/main/java/tn/esprit/data/remote/patient/PatientApiService.java =====
package tn.esprit.data.remote.patient;

import retrofit2.Call;
import retrofit2.http.Body;
import retrofit2.http.GET;
import retrofit2.http.Header;
import retrofit2.http.PUT;
import tn.esprit.domain.patient.PatientProfile;

/**
 * Retrofit API for patient-specific operations.
 *
 * We directly return the domain PatientProfile model.
 */
public interface PatientApiService {

    /**
     * GET /patients/me
     * Authorization: Bearer <access_token>
     */
    @GET("patients/me")
    Call<PatientProfile> getMyProfile(@Header("Authorization") String authorization);

    /**
     * PUT /patients/me
     * Authorization: Bearer <access_token>
     *
     * Body matches backend dto.patient.PatientProfileUpdateRequest
     * (with dates formatted as ISO-8601 strings: yyyy-MM-dd).
     */
    @PUT("patients/me")
    Call<PatientProfile> updateMyProfile(
            @Header("Authorization") String authorization,
            @Body PatientProfileUpdateRequestDto request
    );

    /**
     * DTO mirroring backend PatientProfileUpdateRequest.
     * Used directly as Retrofit request body (no extra mapping).
     */
    class PatientProfileUpdateRequestDto {

        private String dateOfBirth; // ISO date string yyyy-MM-dd
        private String gender;
        private String bloodType;
        private Integer heightCm;
        private Integer weightKg;
        private String address;
        private String city;
        private String country;
        private String maritalStatus;
        private Boolean smoker;
        private Boolean alcoholUse;
        private String notes;

        public PatientProfileUpdateRequestDto() {
        }

        // Getters & setters

        public String getDateOfBirth() {
            return dateOfBirth;
        }

        public void setDateOfBirth(String dateOfBirth) {
            this.dateOfBirth = dateOfBirth;
        }

        public String getGender() {
            return gender;
        }

        public void setGender(String gender) {
            this.gender = gender;
        }

        public String getBloodType() {
            return bloodType;
        }

        public void setBloodType(String bloodType) {
            this.bloodType = bloodType;
        }

        public Integer getHeightCm() {
            return heightCm;
        }

        public void setHeightCm(Integer heightCm) {
            this.heightCm = heightCm;
        }

        public Integer getWeightKg() {
            return weightKg;
        }

        public void setWeightKg(Integer weightKg) {
            this.weightKg = weightKg;
        }

        public String getAddress() {
            return address;
        }

        public void setAddress(String address) {
            this.address = address;
        }

        public String getCity() {
            return city;
        }

        public void setCity(String city) {
            this.city = city;
        }

        public String getCountry() {
            return country;
        }

        public void setCountry(String country) {
            this.country = country;
        }

        public String getMaritalStatus() {
            return maritalStatus;
        }

        public void setMaritalStatus(String maritalStatus) {
            this.maritalStatus = maritalStatus;
        }

        public Boolean getSmoker() {
            return smoker;
        }

        public void setSmoker(Boolean smoker) {
            this.smoker = smoker;
        }

        public Boolean getAlcoholUse() {
            return alcoholUse;
        }

        public void setAlcoholUse(Boolean alcoholUse) {
            this.alcoholUse = alcoholUse;
        }

        public String getNotes() {
            return notes;
        }

        public void setNotes(String notes) {
            this.notes = notes;
        }
    }
}


